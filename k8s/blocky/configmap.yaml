apiVersion: v1
kind: ConfigMap
metadata:
  name: blocky-config
  namespace: dns
data:
  config.yml: |
    # Blocky DNS configuration
    # https://0xerr0r.github.io/blocky/latest/configuration/

    # Upstream DNS servers (DNS-over-HTTPS for privacy)
    upstreams:
      groups:
        default:
          - https://cloudflare-dns.com/dns-query
          - https://dns.google/dns-query

    # Bootstrap DNS for initial DoH resolution
    bootstrapDns:
      - tcp+udp:1.1.1.1
      - tcp+udp:8.8.8.8

    # Blocklists for ad/tracker/malware blocking
    blocking:
      denylists:
        ads:
          # Steven Black unified hosts (comprehensive, fast)
          - https://raw.githubusercontent.com/StevenBlack/hosts/master/hosts
          # AdAway default blocklist
          - https://adaway.org/hosts.txt
          # Peter Lowe's ad and tracking server list
          - https://pgl.yoyo.org/adservers/serverlist.php?hostformat=hosts&showintro=0&mimetype=plaintext
        malware:
          - https://urlhaus.abuse.ch/downloads/hostfile/

      clientGroupsBlock:
        default:
          - ads
          - malware

      # Return 0.0.0.0 for blocked domains
      blockType: zeroIp

      # Blocklist loading settings
      loading:
        refreshPeriod: 4h
        downloads:
          timeout: 60s
          attempts: 2

    # Caching configuration
    caching:
      minTime: 5m
      maxTime: 30m
      prefetching: true
      prefetchExpires: 2h
      prefetchMaxItemsCount: 1000

    # Prometheus metrics
    prometheus:
      enable: true
      path: /metrics

    # DNS ports
    ports:
      dns: 53
      http: 4000

    # Logging
    log:
      level: info
      format: text
